<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/app-datepicker/app-datepicker-dialog.html">

<dom-module id="my-formation">
  <template>
    <style>
      #myProgress {
        width: 100%;
        background-color: #ddd;
      }

      #myBar {
        width: 1%;
        height: 30px;
        background-color: #4CAF50;
      }
      input{
        padding: 7px;
      }
      label{
        margin-right: 5px;
      }
      #container-formacion{
        width: 99%;
        height: 100%;
        border-radius: 50px;
        border: 0px solid lightgray;
        display: flex;
        justify-content: space-between;
      }
      .col{
        width: 50%;
        padding: 20px;
        display: inline-block;
      }
      .cont-input{
        padding: 15% 0 0 0;
      }
      .btn-send{
        padding: 5px;
        background-color: gray;
        color: white;
        width: 90px;
        height: 25px;
        margin-top: 15px;
      }
    </style>

    <div id="">
    <h1>Formación</h1>
     <iron-form id="formFormation">
      <form id="container-formacion">
        <div class="col">
          <div class="cont-input">
            <paper-input type="text" name="institucion" required label="Institución" value="{{currentItem.institucion}}"></paper-input>
          </div>

          <div class="cont-input">
            <paper-input type="text" name="titulacion" required label="Titulación" value="{{currentItem.titulacion}}"></paper-input>
          </div>

          <div class="cont-input">
            <paper-input type="text" name="disciplina" required label="Disciplina" value="{{currentItem.disciplina}}"></paper-input>
          </div>
        </div>
        <div class="col">

            <div class="cont-input">
                <div class="datepicker-dialog" id="desdeDate">
                    <span>Fecha Inicio</span>
                    <paper-button disabled>[[desde]]</paper-button>
                    <paper-icon-button icon="icons:today" on-tap="_openDialogInit"></paper-icon-button>
                    <app-datepicker-dialog id="desde"
                      format="dd/mm/yyyy"
                      date="{{desde}}"
                      locale="es-ES">
                    </app-datepicker-dialog>
                  </div>
            </div>
    
            <div class="cont-input">
              <div class="datepicker-dialog" id="hastaDate">
                  <span>Fecha Fin</span>
                  <paper-button disabled>[[hasta]]</paper-button>
                  <paper-icon-button icon="icons:today" on-tap="_openDialogFinal"></paper-icon-button>
                  <app-datepicker-dialog id="hasta"
                    format="dd/mm/yyyy"
                    date="{{hasta}}"
                    locale="es-ES">
                  </app-datepicker-dialog>
                </div>
            </div>
          
            <template is="dom-repeat" items="{{formation}}">
                <div id="[[index]]" class="listData">
                  <div>Institución: <span>{{item.institucion}}</span></div>
                  <div>Titulo: <span>{{item.titulacion}}</span></div>
                  <div>Disciplina: <span>{{item.disciplina}}</span></div>
                  <div>Desde: <span>{{item.desde}}</span></div>
                  <div>Hasta: <span>{{item.hasta}}</span></div>
                  <paper-icon-button icon="icons:cancel" on-tap="_removeItem"></paper-icon-button>
                  <paper-icon-button icon="icons:create" on-tap="_editItem"></paper-icon-button>
                </div>
            </template>

          <div class="cont-input">
            <paper-button raised on-click="_addData">Añadir</paper-button>
            <paper-button raised on-click="_saveData">Guardar</paper-button>
        </div>
        </div>
      </form>
     </iron-form>
    </div>

      <br>

  </template>

  <script>
    (function appShell(customElements){
      'use strict';

      class MyFormation extends Polymer.Element {
        static get is() { return 'my-formation'; }
        static get properties() {
          return {
            formation: {
              type: Array,
              value: []
            },
            currentItem: {
              type: Object,
              value: {
                institucion: '',
                titulacion: '',
                disciplina: '',
                desde: '',
                hasta: ''
              }
            }
          }
        }

        connectedCallback() {
            super.connectedCallback();
        }

        _openDialogInit(event) {
            this.$.desde.open();
        }

        _openDialogFinal(event) {
            this.$.hasta.open();
        }

        _resetData(event) {
            this.$.hastaDate.style.display = 'block';
            this.$.formFormation.reset();
        }
        
        _formatJson() {
          const form = this.$.formFormation.serializeForm();
          form.desde = this.desde;
          form.hasta = this.hasta;
          return form;
        }
      
        _saveData(){
          this.formation.forEach(element => {
            delete element.edit;
          });

          this.dispatchEvent(new CustomEvent('save-info',{
            bubbles: true,
            detail:{
              key: 'formation',
              data: this.formation
            }
          }));
        }

        _removeItem(event) {
          const index = event.model.index;
          this.splice('formation', index, 1);
        }

        _editItem(event) {
          this._removeItem(event);
          const item = event.model.item;
          console.log(item);
          this.set('currentItem', item);

        }

        _addData(event) {
          const validate = this.$.formFormation.validate();
          if (validate) {
            const form = this._formatJson();
            this.push('formation', form)
            this._resetData();
          }
        }

      }
      customElements.define(MyFormation.is, MyFormation);
    })(window.customElements);
  </script>
</dom-module>
