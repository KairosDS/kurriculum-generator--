<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu-light.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">

<dom-module id="my-language">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>
        <h1>Idioma</h1>
        <iron-form id="languageExperience">
            <template is="dom-repeat" items="{{languages}}" as="language">
                <p>{{language.name}} {{language.level}}</p>
            </template>
            <form>
                <template is="dom-repeat" items="[[languages]]" as="language">
                    <div class="language">
                        <paper-input id="inputForValidation" type="text" name="idioma" label="Idioma" required error-message="Campo requerido" allowed-pattern="[a-zA-Z]"
                            value="{{language.name}}"></paper-input>
                        <paper-dropdown-menu-light label="Competencia">
                            <paper-listbox slot="dropdown-content" class="dropdown-content" selected={{language.level}} required>
                                <template is="dom-repeat" items="[[levels]]" as="level">
                                    <paper-item>{{level}}</paper-item>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu-light>
                        <paper-button raised on-click="_removeLanguage" id$="{{index}}">Eliminar</paper-button>
                    </div>
                </template>


                <paper-button raised on-click="_addLanguage">Agregar</paper-button>
                <paper-button raised on-click="_saveData">Guardar</paper-button>
            </form>
        </iron-form>
    </template>

    <script>
        /**
         * `my-language`
         *
         *
         * @customElement
         * @polymer
         * @demo demo/[[index]].html
         */
        class MyLanguage extends Polymer.Element {
            static get is() { return 'my-language'; }
            static get properties() {
                return {
                    levels: {
                        type: Array,
                        value: ['Principiante', 'Intermedio', 'Avanzado', 'Nativo']
                    },
                    languages: {
                        type: Array,
                        value: []
                    }
                };
            }

            connectedCallback() {
                super.connectedCallback();
            }

            _saveData(event) {
                if (this._validateForm()) {
                    localStorage.setItem('languages', JSON.stringify(this.languages));
                    this._dispatchEvent('languages-saved', this.languages);
                    alert('Data saved!');
                }
            }

            _addLanguage(event) {
                if (this._validateForm()) {
                    const newLanguage = { name: null, level: null };
                    this.push('languages', newLanguage);
                }
            }

            _validateForm() {
                const length = this.languages.length;
                if (length > 0) {
                    return this.$.languageExperience.validate() && this.languages[length - 1].level;
                }
                return this.$.languageExperience.validate();
            }

            _removeLanguage(e) {
                const id = e.target.getAttribute('id');
                this.splice('languages', id, 1);
            }

            _dispatchEvent(event, detail, bubbles = true) {
                this.dispatchEvent(new CustomEvent(event, {
                    bubbles: bubbles,
                    composed: true,
                    detail: detail
                }));
            }
        }

        window.customElements.define(MyLanguage.is, MyLanguage);
    </script>
</dom-module>