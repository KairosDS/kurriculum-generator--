<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">


<dom-module id="my-knowledge">
  <template>
    <style include="app-styles">
      :host {
        display: block;
        margin-top: 10%;
      }
			.content__slider{
				display: flex;
        margin: 15px 0;
			}
      .content__items{
				display: grid;
        grid-template-columns: 1fr 1fr 1fr 0.5fr 0.5fr;
			}
      .content__items__edit{
        display: grid;
        grid-template-columns: 100px 200px 40px;
      }
      .item__added{
        justify-self:center;
        align-self:center;
      }
      .hidden{
        display: none;
      }
      .container-knowledge {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-gap: 15px;
        margin-top: 5%;
      }
    </style>
    <h1>Herramientas</h1>
    <iron-form id="form">
      <form>
        <div>
          <paper-input type="text" name="knowledge" required label="Herramienta (p. ej. Análisis de datos)" value="{{currentKnowledge.knowledge}}"></paper-input>
          <paper-textarea type="text" name="description" rows=2 label="Descripción (Versiones)" value="{{currentKnowledge.description}}"></paper-textarea>
        </div>
        <div class="content__slider">
					<p>0%</p><paper-slider on-change="_change" pin value="{{valueSlider}}"></paper-slider><p>100%</p>
        </div>
        <div class="save-buttons">
          <paper-button class="paper-button-k" raised on-click="_addKnowledge">Agregar</paper-button>
          <paper-button class="paper-button-k" raised on-click="_saveData">Guardar</paper-button>
        </div>
      </form>
		</iron-form>
    <div class="container-knowledge">
  		<template  is="dom-repeat" items="{{knowledges}}" as="item">
        <paper-card>
          <div class="header-card">
            <div class="title-text item__added">{{item.knowledge}}</div>
            <div class="subtitle-text item__added">{{item.percent}}%</div>
          </div>
          <div class="card-content" id="[[index]]">{{item.description}}</div>
          <div class="card-actions">
            <iron-icon  data-id$="[[index]]" on-click="_deleteItem" class="item__added" icon="icons:close"></iron-icon>
            <iron-icon data-id$="[[index]]" class="item__added" on-click="_editItem" icon="icons:create"></iron-icon>
          </div>
        </paper-card>
  		</template>
    </div>
  </template>

  <script>
    /**
     * `my-knowledge`
     *
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class MyKnowledge extends Polymer.Element {
      static get is() { return 'my-knowledge'; }
      static get properties() {
        return {
          knowledges: {
            type: Array,
            value: []
          },
					valueSlider: {
						type:Number,
						value:10
					},
          currentKnowledge: {
            type: Object,
            value: {
              description: ''
            }
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();
      }

			_change(){
				console.log(this.valueSlider)
			}

      _addKnowledge(event) {
        if(this.$.form.validate()){
          const form = this.$.form.serializeForm();
          this.push('knowledges', {
            knowledge:form.knowledge,
            percent: this.valueSlider,
            description: form.description
          });
          this.$.form.reset();
        }
      }
			_saveData(){
        this.dispatchEvent(new CustomEvent('save-info',{
          bubbles: true,
          detail:{
            key: 'knowledges',
            data: this.knowledges
          }
        }));
      }

      _deleteItem(event){
        let id = JSON.parse(event.target.dataset.id);
        this.splice("knowledges", id, 1);
      }
      _editItem(event){
        this._deleteItem(event);
        const item = event.model.item;
        this.set('currentKnowledge', item);
        this.set('valueSlider', item.percent);
      }
    }

    window.customElements.define(MyKnowledge.is, MyKnowledge);
  </script>
</dom-module>
